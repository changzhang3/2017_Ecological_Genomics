{
    "collab_server" : "",
    "contents" : "---\ntitle: \"PCA of rasters\"\nauthor: \"Antdrew D. Nguyen\"\ndate: \"2016-12-07\"\noutput: \n  \n  html_document:\n    theme: spacelab\n    toc: yes\n    toc_depth: 2\n---\n<style type=\"text/css\">\n\nbody{ /* Normal  */\n   font-size: 24px;\n}\n\ncode.r{ /* Code block */\n  font-size: 18px;\n}\npre { /* Code block */\n  font-size: 18px\n}\n</style>\n\nThis is a data demo for performing a PCA on multiple climate raster layers with [*rasterPCA()* function](http://bleutner.github.io/RStoolbox/rstbx-docu/rasterPCA.html).\n\n\n# Load libraries and grabbing dataset\n```{r load libraries}\n#libraries related to maps\nlibrary(sp)\nlibrary(raster)\nlibrary(maps)\nlibrary(mapdata)\nlibrary(RStoolbox)# rasterPCA function\n\n#packages for reading in data\nlibrary(data.table)\n\n\n#reading in dataset\ndat<-fread(\"https://raw.githubusercontent.com/adnguyen/HelmsCahan_CBP-partA_2016/master/Script_Analyses/Sampling_sites_table.csv\")\n\n```\n\n## looking at the data\n```{r}\ndat<-data.frame(dat)\nstr(dat)\n```\n\n## grab bioclim climate variables and add to dataset\n```{r grab bioclim var and dataset}\nw <- getData('worldclim', var='bio', res=2.5) # downloading data\nplot(w,1) # plot of mean annual temperature\n\n#dbio1 <- extract(w, dat[,c(\"Longitude\",\"Latitude\")]) # by column\ndbio1 <- extract(w, dat[,5:6]) #grabbing bioclim variables based on coordinates\nfull.dat <- data.frame(cbind(dat, dbio1[,1:19])) # combining orginal data set with bioclim variables\n\n```\n\n# Plot eastern US unmanipulated climate data\n```{r}\n\nplot(w, 1, xlim=c(-130, -65), ylim=c(25,50), axes=F, legend=F, col=colorRampPalette(c(\"lightblue\",\"orange\"))(255),main=\"\",box=FALSE)\nmap(\"worldHires\",c(\"USA\",\"Canada\"),add=TRUE)\nmap(\"state\", c('florida', 'south carolina', 'north carolina', 'georgia', 'virginia', 'west virginia', 'maryland', 'delaware', 'new jersey', 'rhode island', 'new york', 'connecticut', 'massachusetts', 'pennyslvania', 'vermont', 'new hampshire', 'maine', 'alabama', 'tennessee', 'kentucky', 'ohio','iowa','illinois','arkansas','missouri','minnesota','wisconsin','michigan','louisiana','mississippi',\"texas\",\"arizona\",\"illinois\",\"california\",\"oregon\",\"utah\",\"washington\",\"kansas\",\"new mexico\",\"montana\",\"idaho\",\"wyoming\",\"north dakota\",\"south dakota\",\"nebraska\",\"oklahoma\"), add = TRUE)\n```\n\n# Using rasterPCA function   \nClimate is usually correlated and there are a lot of them. One way to reduce the complexity is to perform a PCA on those variables (19 of them). Also, PCA'ing the whole word will take a long time, so crop the desired region first. \n```{r rasterPCA}\n#look at range of lat and lon\nrange(full.dat[,5]) #lon range\nrange(full.dat[,6]) # lat range\n#designating limits\nlims<-c(-85,-65,30,50)\n\nsubmap<-crop(w,lims)\nplot(submap,1)#plot MAT\nmap(\"worldHires\",c(\"USA\",\"Canada\"),add=TRUE)\nmap(\"state\", c('florida', 'south carolina', 'north carolina', 'georgia', 'virginia', 'west virginia', 'maryland', 'delaware', 'new jersey', 'rhode island', 'new york', 'connecticut', 'massachusetts', 'pennyslvania', 'vermont', 'new hampshire', 'maine', 'alabama', 'tennessee', 'kentucky', 'ohio','iowa','illinois','arkansas','missouri','minnesota','wisconsin','michigan','louisiana','mississippi',\"texas\",\"arizona\",\"illinois\",\"california\",\"oregon\",\"utah\",\"washington\",\"kansas\",\"new mexico\",\"montana\",\"idaho\",\"wyoming\",\"north dakota\",\"south dakota\",\"nebraska\",\"oklahoma\"), add = TRUE)\n\n\n#now we can do pca\npcamap<-rasterPCA(submap,spca=TRUE)\n#check loadings and eigenvalues\nknitr::kable(round(pcamap$model$loadings[,1:3],3)) # top 3 loadings\n#eigenvalues\nsummary(pcamap$model)\n\n#plot first pca1\nplot(pcamap$map,1) #plot the first pca!\nmap(\"worldHires\",c(\"USA\",\"Canada\"),add=TRUE)\nmap(\"state\", c('florida', 'south carolina', 'north carolina', 'georgia', 'virginia', 'west virginia', 'maryland', 'delaware', 'new jersey', 'rhode island', 'new york', 'connecticut', 'massachusetts', 'pennyslvania', 'vermont', 'new hampshire', 'maine', 'alabama', 'tennessee', 'kentucky', 'ohio','iowa','illinois','arkansas','missouri','minnesota','wisconsin','michigan','louisiana','mississippi',\"texas\",\"arizona\",\"illinois\",\"california\",\"oregon\",\"utah\",\"washington\",\"kansas\",\"new mexico\",\"montana\",\"idaho\",\"wyoming\",\"north dakota\",\"south dakota\",\"nebraska\",\"oklahoma\"), add = TRUE)\n\n\n```\n\n## compare pca of climate of sites vs raster layer\n```{r compar pcas}\ndatpca<-princomp(scale(full.dat[,8:26]))\nknitr::kable(round(datpca$loadings[,1:3],3))# pca of sites\n\n#looks similar\n```\n\n\n\n# Session Information\n```{r session information}\nsessionInfo()\n```\n\n",
    "created" : 1484271223288.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3371919562",
    "id" : "6AE08786",
    "lastKnownWriteTime" : 1481583843,
    "last_content_update" : 1481583843,
    "path" : "~/Teaching/2017_Ecological_Genomics/RasterPCA_demo.Rmd",
    "project_path" : "RasterPCA_demo.Rmd",
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}